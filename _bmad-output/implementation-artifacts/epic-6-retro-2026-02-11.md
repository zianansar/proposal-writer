# Epic 6 Retrospective - February 11, 2026

**Project:** Upwork Research Agent
**Epic:** Epic 6 - Proposal Editor & Revision History
**Retrospective Date:** 2026-02-11
**Facilitator:** Bob (Scrum Master)
**Participants:** Zian (Project Lead), Alice (Product Owner), Charlie (Senior Dev), Dana (QA Engineer), Elena (Junior Dev)

---

## Executive Summary

Epic 6 delivered **8/8 stories completed** (100%), establishing a complete proposal editing pipeline with TipTap rich text editor, voice parameter adjustments, revision history with restore, character/word counts, formatting shortcuts, plain-text copy, archive compression, and proposal deletion with CASCADE.

**Key Metrics:**
- **Stories Completed:** 8/8 (100%) — 7th consecutive epic at 100%
- **Tests Written:** ~241 across frontend and backend
- **Code Review Rounds:** 8 (1 per story)
- **Issues Found & Fixed:** ~56 total (0 CRITICAL, 11 HIGH, 20 MEDIUM, 12 LOW + fixes)
- **Migrations Created:** 4 (V22 length_preference, V23 revision columns, V24 archived_revisions, V8 revisions table)
- **Production Incidents:** 0
- **Security Fix:** 1 XSS vulnerability caught and fixed (DOMPurify in 6-3)

**Key Achievement:** Complete FR-6 (Proposal Editing) and FR-7 (Revision History) delivery — rich text editor with auto-save, revision history with archive compression, formatting shortcuts with cross-platform support, and safe deletion with CASCADE.

---

## What Went Well (Successes)

### 1. Zero Explicit Technical Debt

**Evidence:** Unlike previous epics (4b: 10 items, 5: 6 items), Epic 6 documented **zero new technical debt** across all 8 stories. Deferred items are all future enhancements, not shortcuts.

**Impact:**
- Codebase quality maintained — no "we'll fix it later" compromises
- Future epics won't inherit new debt from Epic 6
- Demonstrates maturity in balancing delivery speed with quality

**Lesson:** Smaller, focused stories (editor features) naturally produce less debt than algorithm-heavy stories (scoring). Story scope affects debt accumulation.

### 2. XSS Vulnerability Caught in Code Review (Story 6-3)

**Evidence:** Revision history rendered HTML content without sanitization. Code review flagged this as HIGH — DOMPurify with an allowlist was added to prevent stored XSS.

**Impact:**
- Prevented a security vulnerability from shipping
- Established DOMPurify as the sanitization standard for HTML rendering
- Allowlist approach (only permitted tags) is more secure than blocklist

**Lesson:** Any feature rendering user-generated HTML must use DOMPurify. This should be a code review checklist item.

### 3. Archive Compression Pattern (Story 6-7)

**Evidence:** Revision archiving uses flate2 compression achieving ~70% size reduction. Archived revisions stored as compressed BLOB in the proposals table.

**Impact:**
- MAX_ACTIVE_REVISIONS = 5 keeps the UI clean
- Older revisions preserved without database bloat
- Atomic merge with existing archive prevents data loss
- Archive triggers automatically after each revision creation

**Lesson:** When storing historical data, compress it. The flate2 pattern (compress → BLOB → decompress on demand) is reusable for any append-only data.

### 4. Cross-Platform Shortcut Architecture (Story 6-5)

**Evidence:** Platform detection via `navigator.platform` provides Mac (⌘) vs Windows (Ctrl) shortcuts. The SHORTCUTS object uses property getters for runtime evaluation, solving module-load timing issues.

**Impact:**
- TipTap StarterKit shortcuts (Cmd/Ctrl+B/I/Z) work natively
- Custom Tooltip component with 300ms hover delay and keyboard support
- Deterministic tooltip IDs (counter-based, not Math.random())
- Escape key hides tooltips

**Lesson:** Use property getters (not static constants) for platform-dependent values to avoid module-load timing issues in tests and SSR contexts.

### 5. Plain Text Copy Architecture (Story 6-6)

**Evidence:** `getPlainTextFromEditor()` utility converts rich text to structured plain text: bullets with "• " prefix, numbered lists with "1. 2. 3.", paragraphs separated by double newlines.

**Impact:**
- Copy always produces plain text (per FR-13 manual-copy-only requirement)
- Keyboard shortcut uses `getPlainTextRef` pattern for direct editor access
- Safety check runs on edited content (not original generated)

**Lesson:** When the output medium (Upwork) is plain text, the copy function must strip formatting intelligently — not just `.innerText` but structured conversion preserving list formatting.

### 6. Editor Performance Optimization (Story 6-1)

**Evidence:** TipTap editor stays mounted; content is swapped via `setContent()` instead of remounting. Auto-save with 2-second debounce and exponential backoff retry (3 attempts: 1s/2s/4s).

**Impact:**
- No editor re-initialization cost when switching proposals
- Retry logic prevents data loss on transient save failures
- Timer cleanup prevents memory leaks on unmount

**Lesson:** Rich text editors are expensive to initialize. Keep them mounted and swap content rather than remounting.

---

## What Didn't Go Well (Challenges)

### 1. State Lifetime Complications (Story 6-7)

**Evidence:** Initially planned background archiving with `tokio::spawn`, but Tauri's State lifetime requirements prevented it. Switched to synchronous archiving.

**Impact:**
- Architectural pivot mid-story
- Synchronous approach still meets performance target (<50ms per operation)
- But blocks the main thread briefly during archive operations

**Root Cause:** Tauri's managed state (`State<'_, T>`) doesn't implement `Send`, preventing use in spawned async tasks without cloning the inner value.

**Action Required:** None immediate — <50ms is acceptable. Document the pattern for future reference.

### 2. Test Count Inaccuracies Continue (Story 6-5)

**Evidence:** Story 6-5 initially claimed 57 tests but code review found the actual count was 39. This is the same pattern from Epic 5 (stories 5-2, 5-4, 5-5b).

**Impact:**
- 3rd consecutive epic with test count inaccuracies
- Previous retro's action item "automated test count verification" was not implemented

**Root Cause:** Manual counting is unreliable. The action item to automate this was not converted to a pattern.

**Action Required:** Embed `vitest --reporter=verbose 2>&1 | grep "Tests" | tail -1` output directly in story completion notes.

### 3. AC Violations Caught Late (Stories 6-6, 6-7)

**Evidence:** Story 6-6 HIGH: keyboard shortcut copied HTML instead of plain text (AC-4 violation). Story 6-7 HIGH: restore operations didn't trigger archiving (AC-1 violation).

**Impact:**
- Acceptance criteria literally not met despite story being marked "complete"
- Code review was the only safety net catching these

**Root Cause:** AC checklist verification at story completion is perfunctory — developer marks items done without end-to-end verification of each criterion.

**Action Required:** AC verification should include a "prove it" step — demonstrate each AC is met with a specific test or manual walkthrough.

### 4. Migration Numbering Inconsistencies

**Evidence:** Multiple stories note migration number conflicts: V22 "instead of V8" (6-2), V23 "instead of V8" (6-3), V24 "instead of V9" (6-7). Story 6-8 actually uses V8 for the revisions table.

**Impact:**
- Confusing migration history
- V8 used for revisions table (6-8) but V22-V24 for other changes — suggests 6-8 was implemented before 6-2/6-3/6-7

**Root Cause:** Stories implemented out of numerical order; migration numbers assigned at implementation time rather than planning time.

**Action Required:** None — SQLite migration frameworks handle this. But note that migration ordering ≠ story ordering.

### 5. Story 2-7b: Now 6 Epics Deferred

**Evidence:** Still `backlog`. Epic 5 retro escalated it to "RELEASE BLOCKER." Nothing changed.

**Impact:** Credibility of retrospective process continues to erode. The escalation had no effect.

---

## Key Insights & Lessons Learned

### 1. Focused Scope = Zero Technical Debt

**Insight:** Epic 6's stories were focused, well-scoped editor features. Unlike Epic 4b's algorithmic complexity or Epic 5's analysis pipeline, editor features have clear boundaries and fewer cross-cutting concerns.

**Evidence:** Zero new technical debt items across 8 stories. All deferred items are future enhancements, not shortcuts.

**Application:** When planning epics, smaller/focused stories with clear boundaries naturally produce less debt. Prefer many small stories over few large ones.

### 2. HTML Rendering = Security Checkpoint

**Insight:** Any feature that renders user-generated HTML must sanitize it. Story 6-3's XSS vulnerability was subtle — revision content looked safe because it came from the user's own editor, but stored HTML can still contain malicious payloads.

**Evidence:** DOMPurify with allowlist added to revision preview rendering.

**Application:** Add "DOMPurify required" to code review checklist for any component rendering HTML. Even "trusted" sources need sanitization.

### 3. Synchronous Is Often Good Enough

**Insight:** Background async processing isn't always necessary. Story 6-7's archive operation at <50ms doesn't justify the complexity of async state management with Tauri.

**Evidence:** Switched from tokio::spawn to synchronous archiving. Performance target met. Simpler code.

**Application:** Measure first, optimize later. If an operation takes <100ms, synchronous is usually fine for UX.

### 4. Content Swapping > Component Remounting

**Insight:** For expensive components like rich text editors, keep them mounted and swap content rather than destroying and recreating.

**Evidence:** Story 6-1's TipTap editor uses `setContent()` to swap proposal content without remounting.

**Application:** Apply this pattern to any expensive-to-initialize component (maps, charts, media players).

### 5. Property Getters Solve Module-Load Timing

**Insight:** Platform-dependent values should use property getters, not static constants, to avoid test environment and SSR timing issues.

**Evidence:** Story 6-5's SHORTCUTS object initially used static constants that evaluated `navigator.platform` at module load time. Tests failed because the test environment hadn't set up the mock yet.

**Application:** Any value that depends on runtime environment should use lazy evaluation (getters, functions, or computed properties).

---

## Technical Debt Identified

### CRITICAL Priority (MVP Blocker, Carried)

1. **Story 2-7b: Encrypted Database Access Frontend** (carried from Epic 2 — **6 epics old**)
   - **Issue:** Frontend passphrase unlock not implemented
   - **Impact:** Users can't unlock encrypted database on app restart
   - **Status:** RELEASE BLOCKER (escalated in Epic 5 retro, still not scheduled)

### HIGH Priority (Carried)

2. **API Mocking Infrastructure** (carried from Epic 4a — 4 epics old)
   - **Issue:** No HTTP mocking for Rust tests
   - **Resolution:** Needed before any new API-dependent story

3. **Story 0-5: Validate AI Detection Passing** (Epic 0 — still in-progress)
   - **Issue:** Core product promise unverified

### MEDIUM Priority (Carried)

4. **SettingsPanel Test Harness** (carried from Epic 4b — 3 epics old)
5. **voice.rs Modularization** (carried from Epic 5)
6. **Duplicate Quick Calibration Mapping** (carried from Epic 5)

### LOW Priority (Carried)

7. **Windows Rust build environment** (carried from Epic 4a — 4 epics old)
8. **Syllable counting / bullet patterns / technical terms** (carried from Epic 5)

**New Debt from Epic 6:** 0 items
**Carried from Previous Epics:** 8+ items
**Grand Total Outstanding:** ~12 items (unchanged from Epic 5 — Epic 6 added nothing)

---

## Previous Epic 5 Retro Follow-Through

| # | Commitment | Status | Evidence |
|---|-----------|--------|----------|
| 1 | "Integration Verified" checklist item | ⏳ Partial | 6-1 review caught feature not wired up (same pattern as 5-3) |
| 2 | Automated test count verification | ❌ Not Done | 6-5 had inaccurate test counts (claimed 57, actual 39) |
| 3 | Escalate Story 2-7b to RELEASE BLOCKER | ❌ No Effect | Still `backlog` — now 6 epics deferred |
| 4 | Split voice.rs into submodules | ❌ Not Done | No evidence of refactor |
| 5 | Resolve duplicate mapping logic | ❌ Not Done | Not touched in Epic 6 |

**Follow-Through Rate:** 0/5 completed, 1 partial (10%)

**Team Agreements Follow-Through:**

| Agreement | Status | Evidence |
|-----------|--------|----------|
| Integration Verified mandatory | ⏳ Partial | 6-1 still had unwired feature |
| Graceful degradation by default | ✅ Applied | Editor works without voice profile |
| Prompt injection ordering | ✅ N/A | No prompt changes in Epic 6 |
| Local-first analysis preferred | ✅ N/A | No new analysis in Epic 6 |
| Test counts machine-verified | ❌ Not Done | 6-5 had inaccurate counts |
| 2-7b RELEASE BLOCKER | ❌ No Effect | Still not scheduled |

**Key Observation:** Follow-through rate has now dropped from 17% (Epics 4b, 5) to 10% (Epic 6). The retro action item process is demonstrably broken. Action items are written, acknowledged, and then ignored. The only improvements that stick are ones embedded into daily workflow patterns.

---

## Action Items

### Process Improvements

1. **Embed AC verification as "prove it" step**
   Owner: Dev Agent (team agreement)
   Success criteria: Each AC must cite a specific test name or manual demonstration before marking done

2. **Add "DOMPurify required" to code review checklist for HTML rendering**
   Owner: SM Agent (Bob)
   Success criteria: Any component rendering innerHTML flagged in review if not sanitized

3. **Stop creating standalone action items for infrastructure debt**
   Owner: All
   Rationale: 4 retros of data prove standalone action items don't get done (~13% average follow-through). Instead, embed debt resolution as acceptance criteria in feature stories.

### Team Agreements

- DOMPurify required for any component rendering user-generated HTML
- AC verification requires citing specific test or demonstration ("prove it")
- Archive pattern (compress → BLOB → decompress) for historical data storage
- Content swapping over component remounting for expensive UI components
- Property getters for platform-dependent constants
- **META-AGREEMENT:** No more standalone infrastructure action items. Embed improvements into feature story ACs or they won't happen.

---

## Readiness Assessment

| Dimension | Status | Notes |
|-----------|--------|-------|
| Testing & Quality | ✅ Ready | ~241 tests, all passing, 0 production incidents, 1 XSS fixed |
| Deployment | ⏳ Pre-release | Desktop app not yet deployed |
| Stakeholder Acceptance | ✅ N/A | Solo project |
| Technical Health | ✅ Healthy | Zero new technical debt, clean editor architecture |
| Unresolved Blockers | ✅ None | All ~56 code review issues resolved |

**Overall:** Epic 6 is fully complete. Editor pipeline is production-ready with security hardening.

---

## Retrospective Commitments Summary

- **Stories Completed:** 8/8 (100%) — 7th consecutive 100% epic
- **Technical Debt:** 0 new items + ~12 carried = ~12 total outstanding
- **Test Coverage:** ~241 tests, HIGH confidence
- **Previous Retro Follow-Through:** 0/5 tasks (10%) — worst yet, confirms pattern
- **Meta-Insight:** Standalone action items are a failed strategy. Only embedded patterns work.

### Next Steps

1. **Story 2-7b:** Unblocked from retro process — needs direct scheduling
2. **Story 0-5:** Complete AI Detection Validation
3. **Run Epic 8 retrospective** (final)
4. **Mark Epic 6 as done** in sprint-status.yaml
5. **Post-MVP planning** for Epics 7, 9, 10

---

## Team Acknowledgments

Epic 6 achieved its primary goal: **complete proposal editing pipeline with TipTap rich text, revision history with compression, formatting shortcuts, and safe deletion.**

**Positive Outcomes:**
- FR-6 and FR-7 fully delivered
- Zero new technical debt (first epic to achieve this)
- XSS vulnerability caught and fixed pre-ship
- Archive compression pattern (70% size reduction)
- Cross-platform shortcut architecture
- 100% story completion for 7th consecutive epic

**Architecture Wins:**
- TipTap editor with content swapping (not remounting)
- DOMPurify sanitization for HTML rendering
- flate2 compression for revision archiving
- getPlainTextRef pattern for editor content access
- Property getters for runtime-dependent values

---

**Retrospective Completed:** 2026-02-11
**Next Retrospective:** Epic 8 (Polish, Testing & Accessibility)
**Document:** epic-6-retro-2026-02-11.md
