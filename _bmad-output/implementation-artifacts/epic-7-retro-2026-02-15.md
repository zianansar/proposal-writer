# Epic 7 Retrospective - Proposal History & Data Portability

**Project:** Upwork Research Agent
**Epic:** Epic 7 - Proposal History & Data Portability [POST-MVP Priority 1]
**Retrospective Date:** 2026-02-15
**Facilitator:** Bob (Scrum Master)
**Participants:** Zian (Project Lead), Alice (Product Owner), Charlie (Senior Dev), Dana (QA Engineer), Elena (Junior Dev)

---

## Executive Summary

Epic 7 delivered **7/7 stories completed (100%)** across 4 days (2026-02-12 to 2026-02-15), implementing the full Proposal History & Data Portability feature set. This was the first post-MVP epic, covering proposal outcome tracking, search/filter, analytics, detail views, and encrypted archive export/import — the most security-intensive feature epic since Epic 2 (Encryption).

**Key Metrics:**
- **Stories Completed:** 7/7 (100%) — 10th consecutive epic at 100%
- **Duration:** 4 days (2026-02-12 to 2026-02-15)
- **Code Review Rounds:** 14 (2 per story, 100% multi-round)
- **Issues Found & Fixed:** 51 total across all stories (5 CRITICAL, 8 HIGH, 22 MEDIUM, 16 LOW)
- **Average Issues per Story:** 7.3
- **Test Coverage:** ~692 Rust tests + ~1600 frontend tests passing (story-related tests all green)
- **New Tests Added:** ~150+ (47+61+69+237+40+53+14 from each story)
- **Production Incidents:** 0
- **FRs Delivered:** FR-14 (history view), FR-15 (export/backup)
- **UX Delivered:** UX-6 (response tracking)

**Key Achievement:** Complete data portability — users can now track proposal outcomes, search/filter their history, view analytics dashboards, and export/import their entire database via encrypted `.urb` archives with passphrase protection.

---

## What Went Well (Successes)

### 1. Cohesive Feature Narrative — Stories Built Naturally on Each Other

**Evidence:** Each story in Epic 7 was designed to layer on the previous:
- 7-1 (Schema) → 7-2 (Tracking UI) → 7-3 (Search) → 7-4 (Detail View) → 7-5 (Analytics) → 7-6 (Export) → 7-7 (Import)

**Impact:** No wasted work or throwaway code. Each story's patterns were reused and referenced by subsequent stories. Story 7-7's dev notes explicitly cited patterns from 7-1 through 7-6 for format alignment, TanStack Query invalidation, and navigation patterns.

**Lesson:** Well-ordered story dependencies within an epic reduce friction. The epic structure itself was a force multiplier.

### 2. Security-Intensive Features Delivered Without Blocking

**Evidence:** Stories 7-6 (Export) and 7-7 (Import) implemented:
- Custom `.urb` binary format (URB1 magic header + JSON metadata + salt + encrypted SQLCipher DB)
- Argon2id key derivation with Zeroizing memory wrappers
- ATTACH DATABASE cross-encryption-boundary SQL pattern
- PRAGMA table_info dynamic schema mapping for forward/backward compatibility
- Archive size bomb protection (500MB limit), metadata length validation (1MB)
- UUID-based temp file naming (prevents path injection)
- Startup cleanup sweep for orphaned temp files

**Impact:** Full data portability with defense-in-depth security. Users can move data between machines securely. The ATTACH DATABASE pattern from Epic 2 (Story 2-3 migration) was successfully reused.

**Lesson:** Investing in security patterns early (Epic 2) pays dividends later. The Argon2id + Zeroizing + PRAGMA key infrastructure was ready to reuse.

### 3. Code Review Quality Gate Catching Real Bugs

**Evidence:** 5 CRITICAL issues caught across Epic 7:
- 7-3: Import commands not registered in `invoke_handler` (would crash on invoke)
- 7-4: `get_proposal_detail` + `update_proposal_outcome` not registered (same class)
- 7-7 C-1: `ImportSummary` missing `#[serde(rename_all = "camelCase")]` (all frontend fields would be `undefined`)
- 7-7 C-2: No schema column mapping for older archives (AC-9 would fail with column count mismatch)
- 7-7 C-3: All tasks marked `[ ]` despite full implementation

**Impact:** Without code review, Stories 7-3, 7-4, and 7-7 would have shipped with runtime failures. The serde annotation miss alone would have made the import results screen show blank data.

**Lesson:** Command registration and serde annotations are the #1 and #2 most common CRITICAL-class issues. Consider automated verification for both.

### 4. Consistent Architecture Compliance Across All Stories

**Evidence:** All 7 stories followed established patterns:
- Tauri commands: async, snake_case verb-first naming
- TanStack Query: proper cache invalidation on mutations
- Feature isolation: UI in `src/features/proposal-history/`
- Error handling: typed Rust error enums → user-friendly frontend messages
- Testing: meaningful unit tests with real assertions

**Impact:** Codebase remains consistent and navigable. Any developer can find features by convention.

### 5. Analytics Dashboard — High Value, Clean Implementation (7-5)

**Evidence:** Story 7-5 delivered a full proposal analytics dashboard with:
- Outcome distribution (pie-style breakdown)
- Response rate calculation
- Time-series analytics
- Hook strategy effectiveness comparison
- 35 frontend + 5 Rust tests

**Impact:** Transforms proposal tracking from passive record-keeping to actionable intelligence. Users can now see which hook strategies produce the best outcomes.

---

## What Didn't Go Well (Challenges)

### 1. 100% Multi-Round Code Review — No Improvement from Previous Epics

**Evidence:** Every single story required 2 code review rounds. 51 issues found total (7.3/story average). This mirrors the pattern across all previous epics:
- Epic TD: 7/story avg, 100% multi-round
- Epic 8: 7/story avg, 100% multi-round
- Epic 7: 7.3/story avg, 100% multi-round

**Impact:** Code review remains the only quality gate. Development produces code that compiles, passes tests, and looks correct — but has subtle correctness, security, or design issues.

**Root Cause:** Systemic. The dev agent (claude-sonnet-4-5) produces high-quality code that passes all explicit tests but misses edge cases that only adversarial review catches. The review agent (claude-opus-4-6) consistently finds real issues.

### 2. Command Registration Pattern — Repeated CRITICAL Failures

**Evidence:** Stories 7-3 and 7-4 both had CRITICAL issues where new Tauri commands were created but not registered in `lib.rs invoke_handler`. This is the same class of bug that's appeared in multiple previous epics.

**Impact:** The app would crash with "command not found" errors when invoking the unregistered commands.

**Root Cause:** No automated verification. The dev agent creates commands in `commands/*.rs` and sometimes forgets to add them to the central registration in `lib.rs`. A simple CI check or test could catch this.

### 3. camelCase Serde Annotation — Recurring Frontend/Backend Mismatch

**Evidence:** Story 7-7's `ImportSummary` struct was missing `#[serde(rename_all = "camelCase")]`. The struct serialized as `proposals_imported` (snake_case) but TypeScript expected `proposalsImported` (camelCase). All 8 summary fields would have been `undefined`.

**Impact:** The import results screen would show no data after a successful import — a confusing silent failure.

**Root Cause:** Inconsistent application. `ImportPreview` in the same file had the annotation; `ImportSummary` was missed. This is a class of error that a derive macro or lint rule could prevent.

### 4. Pre-Existing Test Failures Continue to Accumulate

**Evidence:** 9 Rust test failures + 51 frontend test failures are pre-existing across the codebase. These include:
- Keychain tests (no OS context in test runner)
- Migration tests ("Settings count mismatch: old=12, new=14")
- Sanitization timing tests (environment-dependent)
- useProposalEditor debounce/retry timing issues
- OnboardingWizard Router context missing
- TabOrder test assumptions invalidated by new tabs

**Impact:** The test suite's "green bar" is not truly green. Regressions in these areas would be invisible. New developers see a wall of failures and lose confidence in the test infrastructure.

### 5. Story 7-7 Required Most Rework — Complex Cross-Module Feature

**Evidence:** Story 7-7 (Import) had the highest issue count: 10 findings (3 CRITICAL, 3 HIGH, 4 MEDIUM). The R2 fixes required:
- Major refactor: new `build_column_mapped_insert()` + `get_pragma_columns()` functions
- Unified all 12 tables through `import_table_batched()` (was a mix of inline SQL and function calls)
- Expanded settings skip list from 2 → 6 system keys
- Fixed total_records calculation (was counting 5/12 tables)

**Impact:** The most complex story needed the most rework. Cross-module features (import touches security, database, UI, and schema compatibility) have more surface area for issues.

---

## Key Insights & Lessons Learned

### 1. Binary Format Design Requires Careful Forward Compatibility

**Insight:** The `.urb` archive format (7-6) needed to support imports from older archives (7-7). The initial implementation used `SELECT * FROM archive.table` which fails when column counts differ between versions. R2 added dynamic column mapping via `PRAGMA table_info` comparison.

**Evidence:** This was a CRITICAL finding in 7-7 R2. Without it, any archive created before a schema migration would fail to import.

**Application:** When designing binary formats, always design for version skew from day one. The column mapping solution is robust, but it would have been cleaner to include it in the initial implementation.

### 2. Two-Agent Review Model Produces Consistent Quality

**Insight:** The pattern of claude-sonnet for development + claude-opus for adversarial review produces a reliable quality floor. The review consistently finds 5-10 issues per story, almost never "looks good."

**Evidence:** 10 epics, 100% multi-round, 5-10 issues per story, every time. The review model catches real bugs (command registration, serde, schema mapping) not just style nits.

**Application:** This model works. Don't try to eliminate the second round — instead, reduce the severity of findings by creating automated gates for the most common issue classes (command registration, serde annotations, test completeness).

### 3. Data Portability Features Are Intrinsically Complex

**Insight:** Stories 7-6 and 7-7 (export/import) were the most complex in the epic because they cross every layer: binary format, encryption, SQL schema, FK ordering, progress events, and multi-step UI.

**Evidence:** 7-6 had 6 issues, 7-7 had 10 issues + major refactor. Both required understanding of SQLCipher internals, Argon2id, ATTACH DATABASE, PRAGMA table_info, and Tauri events.

**Application:** Cross-cutting features should be estimated at 1.5-2x the effort of single-layer features. Consider breaking them into more granular stories (format spec, reader/writer, schema mapper, UI wizard as separate stories).

### 4. Feature Isolation Pattern Scales Well

**Insight:** All Epic 7 UI components live in `src/features/proposal-history/`. This convention makes features discoverable and prevents UI code sprawl.

**Evidence:** 7 stories added components, tests, and styles within a contained feature directory. Settings integration was minimal (just a button to open the dialog).

**Application:** Continue this pattern for all post-MVP epics. Feature directories with co-located tests and styles are the project's most successful architectural decision.

### 5. Process Improvement Action Items Still Won't Execute

**Insight:** Per the TD retro, process improvements have a near-0% execution rate across all retrospectives. Only items encoded as stories, CI checks, or code changes get done.

**Evidence:** TD retro follow-through rate for process items: 0/5 (0%). Cumulative across 5 retros: ~10%.

**Application:** This retro's action items will be encoded as stories or code changes only. No aspirational process agreements.

---

## Previous Epic TD Retro Follow-Through

| # | Commitment | Status | Evidence |
|---|-----------|--------|----------|
| 1 | MVP is feature-complete | ✅ Done | All MVP epics complete, now building post-MVP |
| 2 | Post-MVP planning when ready | ✅ Done | Epic 7 planned, created, and completed |
| 3 | Remaining debt items non-blocking | ✅ Confirmed | 7 items remain, none blocked Epic 7 |
| 4 | Test infrastructure story for 23 pre-existing failures | ❌ Not Done | Still 9 Rust + 51 frontend failures |

**Follow-Through Rate:** 3/4 (75%) — best rate yet, but the test infrastructure item (the only actionable one) was not done.

**Conclusion:** Pattern continues. Story-based items get done (starting post-MVP work). Infrastructure items without a story don't.

---

## Technical Debt Status — Post-Epic 7

### New Debt Introduced by Epic 7

| # | Item | Priority | Source | Notes |
|---|------|----------|--------|-------|
| 1 | Pre-existing test failures grew from 23 to 60+ | MEDIUM | Accumulated | Migration tests, timing tests, mock drift, Router context |
| 2 | Command registration has no automated check | MEDIUM | 7-3, 7-4 | CRITICAL bugs caught only by review |
| 3 | camelCase serde annotation has no automated check | LOW | 7-7 | Recurring miss pattern |
| 4 | 11 compiler warnings in Rust codebase | LOW | Various | Unused imports, unused variables |

### Remaining Outstanding from Previous (7 items + 4 new = 11 total)

| # | Item | Priority | Notes |
|---|------|----------|-------|
| 1 | 60+ pre-existing test failures (9 Rust + 51 frontend) | MEDIUM | Requires infrastructure: Tauri harness, keychain mocking, migration setup, mock updates |
| 2 | AC-3 creative domain detection gap | MEDIUM | 50% vs 100% technical; recoverable via re-humanization |
| 3 | E2E test stubs (no tauri-driver) | LOW | Scaffolding in place; execution blocked by Tauri ecosystem |
| 4 | Performance benchmark stubs | LOW | Mocked/skipped; needs Tauri runtime |
| 5 | renderWithProviders() shared utility | LOW | Not currently blocking |
| 6 | Stylelint/CI for CSS token enforcement | LOW | Manual pass complete |
| 7 | PasswordHash residual gap (no Zeroize trait) | LOW | Upstream limitation |
| 8 | Command registration CI check | MEDIUM | Would prevent recurring CRITICAL bugs |
| 9 | camelCase serde lint/check | LOW | Would prevent recurring data mismatch |
| 10 | Rust compiler warnings cleanup | LOW | 11 warnings |
| 11 | Migration test "Settings count mismatch" fix | MEDIUM | Tests expect old count, schema evolved |

**Debt Trajectory:** 7 items before Epic 7 → 11 remaining. Net increase of 4 (0 resolved from previous, 4 new identified). The pre-existing test failure count has grown significantly (23 → 60+) as mock drift and schema evolution accumulate.

---

## Next Epic Preview — Epic 9: Platform Deployment & Distribution

**Objective:** Users can install the app on Mac/Windows and receive automatic security updates.

**Scope:** 6-8 stories covering:
- Tauri bundling for macOS (DMG) and Windows (MSI)
- Atomic updates with rollback capability
- Auto-updater for critical security fixes
- Pre-commit hooks (ESLint, Prettier, cargo fmt, clippy)
- Code signing (basic certs initially)
- Distribution via website download

**NFRs:** NFR-13 (safe updates), NFR-14 (macOS 12+, Win 10/11), NFR-16 (auto-update)
**ARs:** AR-21 (pre-commit hooks)

### Dependencies on Epic 7

- Export/Import functionality must be stable (users will need to migrate data during updates)
- Archive format (`.urb`) must be documented for cross-version compatibility
- Settings schema must be stable for update preservation

### Preparation Needed

1. **Tauri bundling setup** — DMG and MSI configuration, signing certificates
2. **Auto-update server** — Hosting for update manifests and binaries
3. **CI/CD pipeline** — Automated builds for both platforms
4. **Test infrastructure decision** — E2E testing strategy for packaged builds

### Significant Changes / Epic Updates Needed

**No significant discoveries** from Epic 7 that impact Epic 9. The export/import infrastructure actually helps Epic 9's update story — users can export before updating as a safety net.

---

## Readiness Assessment

| Dimension | Status | Notes |
|-----------|--------|-------|
| Testing & Quality | ⚠️ Adequate | 692 Rust + ~1600 frontend tests. 60+ pre-existing failures. All Epic 7 tests green. |
| Data Portability | ✅ Complete | Full export/import with encryption, schema compatibility, progress tracking |
| Security | ✅ Strong | SQLCipher + Argon2id + zeroize + archive bomb protection + temp file cleanup |
| Deployment | ⏳ Not Started | Epic 9 scope |
| Technical Health | ✅ Good | Feature isolation, architecture compliance, consistent patterns |
| Unresolved Blockers | ✅ None | No blockers for Epic 9 |

**Overall Assessment:** Epic 7 is complete and solid. The proposal history and data portability features work end-to-end. The codebase remains clean and well-organized. Pre-existing test failures are the main quality concern, but they don't affect Epic 7's functionality.

---

## Retrospective Commitments Summary

### Action Items (Encoded as Stories/Code Changes Only)

1. **Create command registration verification test**
   - Owner: Dev Agent (story)
   - Scope: Automated test that verifies all `#[tauri::command]` functions are registered in `invoke_handler`
   - Success criteria: Catches unregistered commands before code review
   - Priority: HIGH (prevents recurring CRITICAL bugs)

2. **Fix migration test "Settings count mismatch"**
   - Owner: Dev Agent (story)
   - Scope: Update migration tests to expect current settings count (14, not 12)
   - Success criteria: Migration tests pass
   - Priority: MEDIUM

3. **Clean up Rust compiler warnings**
   - Owner: Dev Agent (quick fix)
   - Scope: Fix 11 unused import/variable warnings across codebase
   - Success criteria: `cargo test --lib` compiles with 0 warnings
   - Priority: LOW

### Process Observations (Not Action Items — Just Documented Patterns)

- Code review finds 7+ issues per story — this is the norm, not a problem to fix
- Two-agent model (sonnet dev + opus review) is the project's quality backbone
- Cross-cutting features (export/import) need extra review attention
- Feature isolation pattern continues to scale well

---

## Epic 7 Code Review Summary

| Story | R1 Issues | R2 Issues | Total | Severity Breakdown |
|-------|-----------|-----------|-------|--------------------|
| 7-1 Outcome Tracking Schema | 7 | — | 7 | 1H 3M 3L |
| 7-2 Response Tracking UI | — | 8 | 8 | 5M 3L |
| 7-3 Search and Filter | — | 3 | 3 | 1C 1M 1L |
| 7-4 Detail View | — | 7 | 7 | 1C 2H 2M 2L |
| 7-5 Analytics Dashboard | — | 10 | 10 | 2H 4M 4L |
| 7-6 Export to Archive | — | 6 | 6 | 3M 3L |
| 7-7 Import from Archive | 11* | 10 | 10 | 3C 3H 4M |
| **TOTAL** | — | — | **51** | **5C 8H 22M 16L** |

*7-7 R1 found 11 issues but all were already implemented during development (false positives from stale context).

### Most Common Issue Classes

1. **Command registration missing** (2 stories, CRITICAL) — Tauri commands created but not registered
2. **Serde annotation mismatch** (1 story, CRITICAL) — snake_case serialization vs camelCase frontend
3. **Schema compatibility gaps** (1 story, CRITICAL) — SELECT * fails on column count mismatch
4. **Task/subtask checkboxes not updated** (1 story, CRITICAL) — Story tracking inconsistency
5. **Division by zero guards missing** (2 stories, MEDIUM) — Progress bar NaN when total=0
6. **Trivial/placeholder tests** (1 story, MEDIUM) — Tests that assert true == true
7. **Skip list too narrow** (1 story, HIGH) — Settings import not filtering system keys

---

## Team Acknowledgments

Epic 7 was the most feature-rich post-MVP epic, delivering a complete proposal history and data portability system. Highlights:

- **7-1 + 7-2:** Foundation schema + tracking UI — clean, well-structured, minimal review issues
- **7-3 + 7-4:** Search/filter + detail view — powerful discovery tools with proper command registration (after review fix)
- **7-5:** Analytics dashboard — transforms passive data into actionable intelligence
- **7-6 + 7-7:** Export/import — the technical crown jewels of Epic 7, implementing a custom binary format with full encryption, schema compatibility, and progress tracking

**Project Milestone:** With Epic 7 complete, the Upwork Research Agent has:
- 11 epics completed (10 consecutive at 100% completion rate)
- ~692 Rust + ~1600 frontend automated tests
- Complete data portability (encrypted backup/restore)
- Full proposal lifecycle: generate → track → search → analyze → export → import
- Comprehensive security: SQLCipher, Argon2id, zeroize, PRAGMA rekey, archive encryption

---

**Retrospective Completed:** 2026-02-15
**Document:** epic-7-retro-2026-02-15.md
